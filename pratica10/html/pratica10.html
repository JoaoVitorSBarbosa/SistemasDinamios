<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>pratica10</title>
<meta name="generator" content="MATLAB 24.1">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2024-08-25">
<meta name="DC.source" content="pratica10.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<h2>Contents</h2>
<div>
<ul>
<li>
<a href="#1">Laborat&oacute;rio de Sistemas Din&acirc;micos</a>
</li>
<li>
<a href="#3">Exercicio 1 (a)</a>
</li>
<li>
<a href="#4">M&eacute;todo de Mollenkamp</a>
</li>
<li>
<a href="#5">Exercicio 2 (a)</a>
</li>
<li>
<a href="#6">------ M&eacute;todo de Phillips e Parr ------</a>
</li>
<li>
<a href="#7">Exercicio 2 (b)</a>
</li>
<li>
<a href="#8">------ Equa&ccedil;&otilde;es de Overshoot ------</a>
</li>
<li>
<a href="#9">Exercicio 2 (c)</a>
</li>
<li>
<a href="#10">------ M&eacute;todo de Mollenkamp ------</a>
</li>
<li>
<a href="#11">Exercicio 2 (d)</a>
</li>
<li>
<a href="#12">------ M&eacute;todo de Sundaresan ------</a>
</li>
<li>
<a href="#13">Exercicio 3</a>
</li>
</ul>
</div>
<h2 id="1">Laborat&oacute;rio de Sistemas Din&acirc;micos</h2>
<p>Pr&aacute;tica 10 Data: 25/08/2024 Autores: Ana Clara Gomes &amp; Jo&atilde;o Vitor Barbosa</p>
<pre class="codeinput">
<span class="comment">% Limpar Workspace</span>
clear <span class="string">all</span>;
close <span class="string">all</span>;
clc;
</pre>
<p>Script Pr&aacute;tica 10</p>
<h2 id="3">Exercicio 1 (a)</h2>
<pre class="codeinput">disp(<span class="string">'M&eacute;todo Sundaresan 2 ordem sobreamortecido'</span>)
dados = load(<span class="string">'dadosordem2sobre.txt'</span>);

tempo = dados(:,1);
entrada = dados(:,2);
saida = dados(:,3);

tm  = 400;
x1 = 48;
x2 = 260;
y1 = 2;
y2 = 6;

<span class="comment">% A determina&ccedil;&atilde;o dessas par&acirc;metros se da atraves da reta tangente ao ponto</span>
<span class="comment">%de inflex&atilde;o dos dados;</span>

Mi = (y2 - y1) / (x2 - x1);

Ganho = mean(saida(end-50:end));

saidaNormalizada = saida / Ganho;

plot(tempo, saida, <span class="string">'b'</span>, <span class="string">'DisplayName'</span>, <span class="string">'Dados experimentais'</span>);
grid <span class="string">on</span>;
hold <span class="string">on</span>;


m1 = trapz(dados(:,1),1 - saidaNormalizada);


lambda = (tm - m1) * Mi;
n = 1;
tau1 = (n ^ (n/(1-n))) / Mi;
tau2 = (1 ^ (n/(1-n))) / Mi;
taud = m1- tau1 - tau2;
s = tf(<span class="string">'s'</span>);
Hs = (exp(-taud * s)) / (((tau1 * s) + 1) * ((tau1 * s) + 1));
step(Hs * 10,<span class="string">'r'</span>);
disp([<span class="string">'m1: '</span> num2str(m1)]);
disp([<span class="string">'Mi: '</span> num2str(Mi)]);
disp([<span class="string">'lambda: '</span> num2str(lambda)]);
disp([<span class="string">'n: '</span> num2str(n)]);
disp([<span class="string">'tau1: '</span> num2str(tau1)]);
disp([<span class="string">'tau2: '</span> num2str(tau2)]);
disp([<span class="string">'taud: '</span> num2str(taud)]);
grid <span class="string">on</span>;
hold <span class="string">off</span>;

<span class="comment">% Para o modelo de segunda ordem, primeiramente deve-se entender os par&acirc;metros de ganho e tm.</span>
<span class="comment">% O ganho &eacute; calculado pelo MatLab pelos 50 valores de estabiliza&ccedil;&atilde;o ao final do sistema e tm &eacute; obtido visualmente,</span>
<span class="comment">% tra&ccedil;ando uma reta no ponto de inflex&atilde;o e tomando o tempo em que o sistema se estabiliza no prolongamento dessa reta.</span>
<span class="comment">% Para determinar os par&acirc;metros usamos as equa&ccedil;&otilde;es presentes no slide</span>
<span class="comment">% nota-se uma grande dificuldade devido a depend&ecirc;ncia da reta tangente</span>
</pre>
<pre class="codeoutput">M&eacute;todo Sundaresan 2 ordem sobreamortecido
m1: 109.1122
Mi: 0.018868
lambda: 5.4884
n: 1
tau1: 53
tau2: 53
taud: 3.1122
</pre>
<img vspace="5" hspace="5" src="pratica10_01.png" alt=""> <h2 id="4">M&eacute;todo de Mollenkamp</h2>
<pre class="codeinput">dados = load(<span class="string">'dadosordem2sobre.txt'</span>);
t = dados(:,1);
u = dados(:,2);
y = dados(:,3);
k =  mean(dados(end-50:end));
kn = k/k;

yn = y/k;

yt1 = 0.15*k;
yt2 = 0.45*k;
yt3 = 0.75*k;
t1 = 43;
t2 = 83.5;
t3 = 143.5;

x = (t2-t1)/(t3-t1);
zeta = (0.0805-5.547*(0.475-x)^2)/(x-0.356);
f1 = 0.708*(2.811^zeta);
wn = f1/(t3-t1);
f2 = 0.922*(1.66^zeta);
teta = t2-f2/wn;

G1 = tf(kn*wn^2, [1 2*zeta*wn wn^2]);
plot(t,yn);
grid <span class="string">on</span>
hold <span class="string">on</span>;
step(G1, <span class="string">'r'</span>);
grid <span class="string">on</span>
hold <span class="string">on</span>;

<span class="comment">% Neste m&eacute;todo foi necess&aacute;rio obter tr&ecirc;s tempos:</span>
<span class="comment">% t1 = 43 quando a sa&iacute;da est&aacute; em 15% do ganho, t2 = 83.5 quando a sa&iacute;da est&aacute; em 45% e t3 = 143.5 quando a sa&iacute;da est&aacute; em 75% .</span>
<span class="comment">% Esses tempos foram obtidos visualmente</span>
hold <span class="string">off</span>;
</pre>
<img vspace="5" hspace="5" src="pratica10_02.png" alt=""> <h2 id="5">Exercicio 2 (a)</h2>
<p>Calcular o Ganho K = 5 (Olhando no gr&aacute;fico) Calcular Teta = 3 (Olhando no Gr&aacute;fico)</p>
<pre class="codeinput">N = 2; <span class="comment">%N&uacute;mero de ciclos vis&iacute;veis ocorrem em aproximadamente 10 seg.</span>
T = 10/N;
Wn = 2*pi/T;<span class="comment">% Frequ&ecirc;ncia Natural</span>
Zeta = 0.6/N;<span class="comment">% Fator de Amortecimento</span>
Teta = 3; <span class="comment">% Tempo Morto</span>
s = tf(<span class="string">'s'</span>);
Hs = (exp(-Teta*s)*Wn^2)/(s^2 + 2*Zeta*Wn*s + Wn^2);
hold <span class="string">on</span>;
step(Hs*5, <span class="string">'r'</span>);
grid <span class="string">on</span>
title(<span class="string">'M&eacute;todo Phillips e Parr'</span>);
legend({<span class="string">'Dados iniciais'</span>, <span class="string">'M&eacute;todo Phillips e Parr'</span>})
hold <span class="string">off</span>;
</pre>
<img vspace="5" hspace="5" src="pratica10_03.png" alt=""> <h2 id="6">------ M&eacute;todo de Phillips e Parr ------</h2>
<pre class="codeinput">dados = load(<span class="string">'dadosordem2sub.txt'</span>);
t = dados(:,1);
u = dados(:,2);
y = dados(:,3);
k =  mean(dados(end-50:end));
kn = k/k;

yn = y/k;
N = 2;
T = 10/N;
wn = 2*pi/T;
zeta = 0.6/N;
Teta = 3;
G1 = tf(kn*wn^2, [1 2*zeta*wn wn^2], <span class="string">'InputDelay'</span>, Teta);
hold <span class="string">on</span>;
plot(t,yn); grid <span class="string">on</span>
plot(t,yn); grid <span class="string">on</span>;

step(G1, <span class="string">'r'</span>);
grid <span class="string">on</span>
title(<span class="string">'M&eacute;todo Phillips e Parr'</span>);
legend({<span class="string">'Dados iniciais'</span>, <span class="string">'M&eacute;todo Phillips e Parr'</span>})
hold <span class="string">off</span>;
</pre>
<img vspace="5" hspace="5" src="pratica10_04.png" alt=""> <h2 id="7">Exercicio 2 (b)</h2>
<pre class="codeinput">N = 2; <span class="comment">%N&uacute;mero de ciclos vis&iacute;veis ocorrem em aproximadamente 10 seg.</span>
T = 10/N;
Wn = 2*pi/T; <span class="comment">% Frequ&ecirc;ncia Natural</span>
Zeta = 0.6/N; <span class="comment">% Fator de Amortecimento</span>

Beta = sqrt(1 - Zeta^2);
Teta = 1/cos(Zeta); <span class="comment">%Usado com a equa&ccedil;&atilde;o 2</span>
yt = 1 - (exp(-Zeta*Wn.*tempo)/Beta).*(Beta*cos(Wn*Beta.*tempo) + Zeta*sin(Wn*Beta.*tempo));
yt = 1 - (exp(-Zeta*Wn.*tempo)/Beta).*sin(Wn*Beta*tempo + Teta);
plot(tempo, yt, <span class="string">'g'</span>);
grid <span class="string">on</span>;
hold <span class="string">on</span>;
</pre>
<img vspace="5" hspace="5" src="pratica10_05.png" alt=""> <h2 id="8">------ Equa&ccedil;&otilde;es de Overshoot ------</h2>
<pre class="codeinput">dados = load (<span class="string">'dadosordem2sub.txt'</span>); <span class="comment">% carrega arquivo txt</span>
tempo = dados(:,1);
u = dados(:,2);
y = dados(:,3);

k =  mean(dados(end-50:end));
yn = y/k;
N = 2; <span class="comment">%N&uacute;mero de ciclos vis&iacute;veis ocorrem em aproximadamente 10 seg.</span>
T = 10/N;
Wn = 2*pi/T; <span class="comment">% Frequ&ecirc;ncia Natural</span>
Zeta = 0.6/N; <span class="comment">% Fator de Amortecimento</span>

Beta = sqrt(1 - Zeta^2);
Teta = 1/cos(Zeta); <span class="comment">%Usado com a equa&ccedil;&atilde;o 2</span>
yt = 1 - (exp(-Zeta*Wn.*tempo)/Beta).*(Beta*cos(Wn*Beta.*tempo) + Zeta*sin(Wn*Beta.*tempo));
yt = 1 - (exp(-Zeta*Wn.*tempo)/Beta).*sin(Wn*Beta*tempo + Teta);
plot(tempo, yt, <span class="string">'g'</span>);
grid <span class="string">on</span>;
hold <span class="string">on</span>;
plot (tempo, yn);
grid <span class="string">on</span>;
hold <span class="string">off</span>;
</pre>
<img vspace="5" hspace="5" src="pratica10_06.png" alt=""> <h2 id="9">Exercicio 2 (c)</h2>
<p>Desconsiderar o tempo morto e condi&ccedil;&atilde;o inicial nula T1 = 0.15*Yf; T2 = 0.45*Yf; T3 = 0.75*Yf;</p>
<pre class="codeinput">dados = load (<span class="string">'dadosordem2sub.txt'</span>); <span class="comment">% carrega arquivo txt</span>
tempo = dados(:,1);
u = dados(:,2);
y = dados(:,3);
plot (tempo, y);
grid()

norm_u = dados(:,2)/max(u);
norm_y = (dados(:,3)- min(y))/(max(y)-min(y));

Yi = mean(y(1:20));
Yf = mean(y(end-50:end));
T1 = 0.15*Yf;
T2 = 0.45*Yf;
T3 = 0.75*Yf;

x = (T2 - T1)/(T3 - T1);
Zeta = (0.0805 - 5.547*(0.475 - x)^2)/(x - 0.356); <span class="comment">% Fator de Amortecimento</span>

<span class="keyword">if</span> Zeta &lt; 1
    F1 = 0.708*(2.811)^Zeta;

<span class="keyword">else</span>
    F1 = 2.6*Zeta - 0.6;
    Tau_1 = (Zeta + sqrt(Zeta^2 - 1))/Wn;
    Tau_2 = (Zeta - sqrt(Zeta^2 - 1))/Wn;
<span class="keyword">end</span>

Wn = F1/(T3 - T1); <span class="comment">% Frequ&ecirc;ncia Natural</span>
F2 = 0.922*(1.66)^Zeta;
Teta = T2 - F2/Wn; <span class="comment">% Tempo Morto</span>

s = tf(<span class="string">'s'</span>);
Hs = (exp(Teta*s)*Wn^2)/(s^2 + 2*Zeta*Wn*s + Wn^2);
hold <span class="string">on</span>;
step(Hs*5, <span class="string">'r'</span>);
grid <span class="string">on</span>
hold <span class="string">off</span>;
</pre>
<img vspace="5" hspace="5" src="pratica10_07.png" alt=""> <h2 id="10">------ M&eacute;todo de Mollenkamp ------</h2>
<pre class="codeinput">dados = load(<span class="string">'dadosordem2sub.txt'</span>);
t = dados(:,1);
u = dados(:,2);
y = dados(:,3);
k =  mean(dados(end-50:end));
kn = k/k;

yn = y/k;

yt1 = 0.15*k;
yt2 = 0.45*k;
yt3 = 0.75*k;
t1 = 3.29;
t2 = 3.56;
t3 = 3.78;

x = (t2-t1)/(t3-t1);
zeta = (0.0805-5.547*(0.475-x)^2)/(x-0.356);
f1 = 0.708*(2.811^zeta);
wn = f1/(t3-t1);
f2 = 0.922*(1.66^zeta);
teta = t2-f2/wn;

G1 = tf(kn*wn^2, [1 2*zeta*wn wn^2], <span class="string">'InputDelay'</span>, teta);
plot(t,yn);
grid <span class="string">on</span>
hold <span class="string">on</span>;
step(G1, <span class="string">'r'</span>);
grid <span class="string">on</span>
hold <span class="string">on</span>;
hold <span class="string">off</span>;
</pre>
<img vspace="5" hspace="5" src="pratica10_08.png" alt=""> <h2 id="11">Exercicio 2 (d)</h2>
<p>H(s) = e^(-Td*s)/(T1*s + 1)*(T2*s + 1)</p>
<pre class="codeinput">m1 = trapz(norm_u)*0.01 - trapz(norm_y)*0.01;
tm = 4; <span class="comment">% Encontrado de acordo com a inclina&ccedil;&atilde;o da reta tangente</span>
Mi = 1/tm; <span class="comment">% Inclina&ccedil;&atilde;o da Reta Tangente</span>
lambda = (tm - m1)*Mi; <span class="comment">% 0.2206</span>
n = 0.1; <span class="comment">% Encontrado pelo gr&aacute;fico, a partir do lambda</span>
T1 = n^(n/(1-n))/Mi; <span class="comment">% Polo T1 do Sistema</span>
T2 = n^(1/(1-n))/Mi; <span class="comment">% Polo T2 do Sistema</span>
Td = m1 - T1 - T2; <span class="comment">% Teta (Tempo Morto)</span>

s = tf(<span class="string">'s'</span>);
Hs = exp(-Td*s)/((T1*s + 1)*(T2*s + 1));
hold <span class="string">on</span>;
step(Hs, <span class="string">'r'</span>);
grid <span class="string">on</span>
hold <span class="string">off</span>;
</pre>
<img vspace="5" hspace="5" src="pratica10_09.png" alt=""> <h2 id="12">------ M&eacute;todo de Sundaresan ------</h2>
<pre class="codeinput">dados = load(<span class="string">'dadosordem2sub.txt'</span>);
t = dados(:,1);
u = dados(:,2);
y = dados(:,3);
k =  mean(dados(end-50:end));
kn = k/k;

yn = y/k;
teta_tau = trapz(t, u- yn);

teta = 10;
tm = 10;
M1 = 1/(tm-teta);

mi = teta_tau;
lambda = (tm - mi)*M1;
n = 0.9;

t1 = (n^(n/(1-n)))/M1;
t2 = (n^(1/(1-n)))/M1;
tauD = mi - t1 - t2;

G1 = tf(kn, [0.9592 3.407 1], <span class="string">'InputDelay'</span>, tauD);
plot(t, yn);
grid <span class="string">on</span>
hold <span class="string">on</span>;
step(G1, <span class="string">'r'</span>);
grid <span class="string">on</span>
hold <span class="string">on</span>;
hold <span class="string">off</span>;
</pre>
<img vspace="5" hspace="5" src="pratica10_10.png" alt=""> <h2 id="13">Exercicio 3</h2>
<pre class="codeinput">dados = load(<span class="string">'dadosordem2aleatorio.txt'</span>);
t = dados(:,1);
u = dados(:,2);
y = dados(:,3);

u_norm = u - mean(u);
y_norm = y - mean(y);

impulse_response = deconv(y_norm, u_norm);

figure;
plot(t(1:length(impulse_response)), impulse_response);
title(<span class="string">'Resposta ao Impulso'</span>);
xlabel(<span class="string">'Tempo (s)'</span>);
ylabel(<span class="string">'Amplitude'</span>);
grid <span class="string">on</span>;

U = fft(u_norm);
Y = fft(y_norm);

frequency_response = Y ./ U;

N = length(t);
fs = 1 / (t(2) - t(1));
f = (0:N-1)*(fs/N);

figure;
plot(f, abs(frequency_response));
title(<span class="string">'Resposta em Frequ&ecirc;ncia'</span>);
xlabel(<span class="string">'Frequ&ecirc;ncia (Hz)'</span>);
ylabel(<span class="string">'Amplitude'</span>);
grid <span class="string">on</span>;
hold <span class="string">off</span>;
</pre>
<img vspace="5" hspace="5" src="pratica10_11.png" alt=""> <img vspace="5" hspace="5" src="pratica10_12.png" alt=""> <p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2024a</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
%% Laboratório de Sistemas Dinâmicos
% Prática 10
% Data: 25/08/2024
% Autores: Ana Clara Gomes & João Vitor Barbosa

% Limpar Workspace
clear all;
close all;
clc;

%%
% Script Prática 10

%% Exercicio 1 (a)
disp('Método Sundaresan 2 ordem sobreamortecido')
dados = load('dadosordem2sobre.txt');

tempo = dados(:,1);
entrada = dados(:,2);
saida = dados(:,3);

tm  = 400;
x1 = 48;
x2 = 260;
y1 = 2;
y2 = 6;

% A determinação dessas parâmetros se da atraves da reta tangente ao ponto
%de inflexão dos dados;

Mi = (y2 - y1) / (x2 - x1);

Ganho = mean(saida(end-50:end));

saidaNormalizada = saida / Ganho;

plot(tempo, saida, 'b', 'DisplayName', 'Dados experimentais'); 
grid on;
hold on;


m1 = trapz(dados(:,1),1 - saidaNormalizada);


lambda = (tm - m1) * Mi;
n = 1;
tau1 = (n ^ (n/(1-n))) / Mi;
tau2 = (1 ^ (n/(1-n))) / Mi;
taud = m1- tau1 - tau2;
s = tf('s');
Hs = (exp(-taud * s)) / (((tau1 * s) + 1) * ((tau1 * s) + 1));
step(Hs * 10,'r');
disp(['m1: ' num2str(m1)]);
disp(['Mi: ' num2str(Mi)]);
disp(['lambda: ' num2str(lambda)]);
disp(['n: ' num2str(n)]);
disp(['tau1: ' num2str(tau1)]);
disp(['tau2: ' num2str(tau2)]);
disp(['taud: ' num2str(taud)]);
grid on;
hold off;

% Para o modelo de segunda ordem, primeiramente deve-se entender os parâmetros de ganho e tm. 
% O ganho é calculado pelo MatLab pelos 50 valores de estabilização ao final do sistema e tm é obtido visualmente,
% traçando uma reta no ponto de inflexão e tomando o tempo em que o sistema se estabiliza no prolongamento dessa reta.
% Para determinar os parâmetros usamos as equações presentes no slide
% nota-se uma grande dificuldade devido a dependência da reta tangente
%% Método de Mollenkamp
dados = load('dadosordem2sobre.txt'); 
t = dados(:,1);
u = dados(:,2);
y = dados(:,3);
k =  mean(dados(end-50:end));
kn = k/k;

yn = y/k;

yt1 = 0.15*k;
yt2 = 0.45*k;
yt3 = 0.75*k;
t1 = 43;
t2 = 83.5;
t3 = 143.5;

x = (t2-t1)/(t3-t1);
zeta = (0.0805-5.547*(0.475-x)^2)/(x-0.356);
f1 = 0.708*(2.811^zeta);
wn = f1/(t3-t1);
f2 = 0.922*(1.66^zeta);
teta = t2-f2/wn;

G1 = tf(kn*wn^2, [1 2*zeta*wn wn^2]);
plot(t,yn); 
grid on
hold on;
step(G1, 'r');
grid on
hold on;

% Neste método foi necessário obter três tempos: 
% t1 = 43 quando a saída está em 15% do ganho, t2 = 83.5 quando a saída está em 45% e t3 = 143.5 quando a saída está em 75% . 
% Esses tempos foram obtidos visualmente
hold off;

%% Exercicio 2 (a)
% Calcular o Ganho K = 5 (Olhando no gráfico)
% Calcular Teta = 3 (Olhando no Gráfico)
N = 2; %Número de ciclos visíveis ocorrem em aproximadamente 10 seg.
T = 10/N;
Wn = 2*pi/T;% Frequência Natural
Zeta = 0.6/N;% Fator de Amortecimento
Teta = 3; % Tempo Morto
s = tf('s');
Hs = (exp(-Teta*s)*Wn^2)/(s^2 + 2*Zeta*Wn*s + Wn^2);
hold on;
step(Hs*5, 'r');
grid on
title('Método Phillips e Parr');
legend({'Dados iniciais', 'Método Phillips e Parr'})
hold off;

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH Método de Phillips e Parr REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
dados = load('dadosordem2sub.txt'); 
t = dados(:,1);
u = dados(:,2);
y = dados(:,3);
k =  mean(dados(end-50:end));
kn = k/k;

yn = y/k;
N = 2; 
T = 10/N;
wn = 2*pi/T;
zeta = 0.6/N;
Teta = 3; 
G1 = tf(kn*wn^2, [1 2*zeta*wn wn^2], 'InputDelay', Teta);
hold on;
plot(t,yn); grid on
plot(t,yn); grid on;

step(G1, 'r');
grid on
title('Método Phillips e Parr');
legend({'Dados iniciais', 'Método Phillips e Parr'})
hold off;

%% Exercicio 2 (b)
N = 2; %Número de ciclos visíveis ocorrem em aproximadamente 10 seg.
T = 10/N;
Wn = 2*pi/T; % Frequência Natural
Zeta = 0.6/N; % Fator de Amortecimento

Beta = sqrt(1 - Zeta^2);
Teta = 1/cos(Zeta); %Usado com a equação 2
yt = 1 - (exp(-Zeta*Wn.*tempo)/Beta).*(Beta*cos(Wn*Beta.*tempo) + Zeta*sin(Wn*Beta.*tempo));
yt = 1 - (exp(-Zeta*Wn.*tempo)/Beta).*sin(Wn*Beta*tempo + Teta);
plot(tempo, yt, 'g'); 
grid on; 
hold on;

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH Equações de Overshoot REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
dados = load ('dadosordem2sub.txt'); % carrega arquivo txt
tempo = dados(:,1);
u = dados(:,2);
y = dados(:,3);

k =  mean(dados(end-50:end));
yn = y/k;
N = 2; %Número de ciclos visíveis ocorrem em aproximadamente 10 seg.
T = 10/N;
Wn = 2*pi/T; % Frequência Natural
Zeta = 0.6/N; % Fator de Amortecimento

Beta = sqrt(1 - Zeta^2);
Teta = 1/cos(Zeta); %Usado com a equação 2
yt = 1 - (exp(-Zeta*Wn.*tempo)/Beta).*(Beta*cos(Wn*Beta.*tempo) + Zeta*sin(Wn*Beta.*tempo));
yt = 1 - (exp(-Zeta*Wn.*tempo)/Beta).*sin(Wn*Beta*tempo + Teta);
plot(tempo, yt, 'g');
grid on; 
hold on;
plot (tempo, yn);
grid on;
hold off;

%% Exercicio 2 (c)
% Desconsiderar o tempo morto e condição inicial nula
% T1 = 0.15*Yf;
% T2 = 0.45*Yf;
% T3 = 0.75*Yf;

dados = load ('dadosordem2sub.txt'); % carrega arquivo txt
tempo = dados(:,1);
u = dados(:,2);
y = dados(:,3);
plot (tempo, y);
grid()

norm_u = dados(:,2)/max(u);
norm_y = (dados(:,3)- min(y))/(max(y)-min(y));

Yi = mean(y(1:20));
Yf = mean(y(end-50:end));
T1 = 0.15*Yf;
T2 = 0.45*Yf;
T3 = 0.75*Yf;

x = (T2 - T1)/(T3 - T1);
Zeta = (0.0805 - 5.547*(0.475 - x)^2)/(x - 0.356); % Fator de Amortecimento

if Zeta < 1
    F1 = 0.708*(2.811)^Zeta;
    
else
    F1 = 2.6*Zeta - 0.6;
    Tau_1 = (Zeta + sqrt(Zeta^2 - 1))/Wn;
    Tau_2 = (Zeta - sqrt(Zeta^2 - 1))/Wn;
end

Wn = F1/(T3 - T1); % Frequência Natural
F2 = 0.922*(1.66)^Zeta;
Teta = T2 - F2/Wn; % Tempo Morto

s = tf('s');
Hs = (exp(Teta*s)*Wn^2)/(s^2 + 2*Zeta*Wn*s + Wn^2);
hold on;
step(Hs*5, 'r');
grid on
hold off;

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH Método de Mollenkamp REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
dados = load('dadosordem2sub.txt'); 
t = dados(:,1);
u = dados(:,2);
y = dados(:,3);
k =  mean(dados(end-50:end));
kn = k/k;

yn = y/k;

yt1 = 0.15*k;
yt2 = 0.45*k;
yt3 = 0.75*k;
t1 = 3.29;
t2 = 3.56;
t3 = 3.78;

x = (t2-t1)/(t3-t1);
zeta = (0.0805-5.547*(0.475-x)^2)/(x-0.356);
f1 = 0.708*(2.811^zeta);
wn = f1/(t3-t1);
f2 = 0.922*(1.66^zeta);
teta = t2-f2/wn;

G1 = tf(kn*wn^2, [1 2*zeta*wn wn^2], 'InputDelay', teta);
plot(t,yn); 
grid on
hold on;
step(G1, 'r');
grid on
hold on;
hold off;

%% Exercicio 2 (d)
% H(s) = e^(-Td*s)/(T1*s + 1)*(T2*s + 1)

m1 = trapz(norm_u)*0.01 - trapz(norm_y)*0.01;
tm = 4; % Encontrado de acordo com a inclinação da reta tangente
Mi = 1/tm; % Inclinação da Reta Tangente
lambda = (tm - m1)*Mi; % 0.2206
n = 0.1; % Encontrado pelo gráfico, a partir do lambda
T1 = n^(n/(1-n))/Mi; % Polo T1 do Sistema
T2 = n^(1/(1-n))/Mi; % Polo T2 do Sistema
Td = m1 - T1 - T2; % Teta (Tempo Morto)

s = tf('s');
Hs = exp(-Td*s)/((T1*s + 1)*(T2*s + 1));
hold on;
step(Hs, 'r');
grid on
hold off;

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH Método de Sundaresan REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
dados = load('dadosordem2sub.txt'); 
t = dados(:,1);
u = dados(:,2);
y = dados(:,3);
k =  mean(dados(end-50:end));
kn = k/k;

yn = y/k;
teta_tau = trapz(t, u- yn);

teta = 10;
tm = 10;
M1 = 1/(tm-teta);

mi = teta_tau;
lambda = (tm - mi)*M1;
n = 0.9;

t1 = (n^(n/(1-n)))/M1;
t2 = (n^(1/(1-n)))/M1;
tauD = mi - t1 - t2;

G1 = tf(kn, [0.9592 3.407 1], 'InputDelay', tauD);
plot(t, yn); 
grid on
hold on;
step(G1, 'r');
grid on
hold on;
hold off;

%% Exercicio 3
dados = load('dadosordem2aleatorio.txt');
t = dados(:,1);
u = dados(:,2);
y = dados(:,3);

u_norm = u - mean(u);
y_norm = y - mean(y);

impulse_response = deconv(y_norm, u_norm);

figure;
plot(t(1:length(impulse_response)), impulse_response);
title('Resposta ao Impulso');
xlabel('Tempo (s)');
ylabel('Amplitude');
grid on;

U = fft(u_norm);
Y = fft(y_norm);

frequency_response = Y ./ U;

N = length(t);
fs = 1 / (t(2) - t(1));
f = (0:N-1)*(fs/N);

figure;
plot(f, abs(frequency_response));
title('Resposta em Frequência');
xlabel('Frequência (Hz)');
ylabel('Amplitude');
grid on;
hold off;

##### SOURCE END #####
-->
</body>
</html>
